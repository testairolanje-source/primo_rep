<!DOCTYPE html>
<html lang="it">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Gioco a Livelli â€“ Vinci il Premio!</title>
Â  <style>
Â  Â  :root{
      --bg: #0f172a;
      --text: #e5e7eb;
      --soft: #9ca3af;
      --primary: #22c55e;
      --accent: #60a5fa;
      --danger: #ef4444;
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
Â  Â  *{box-sizing:border-box}
Â  Â  html,body{height:100%}
Â  Â  body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif; background: radial-gradient(1200px 800px at 80% -10%, #1e293b 0, transparent 60%), radial-gradient(1000px 600px at -10% 110%, #111827 0, transparent 60%), var(--bg); color:var(--text);}
Â  Â  .wrap{max-width:1100px; margin:0 auto; padding:24px}
Â  Â  header{display:flex; align-items:center; gap:16px; justify-content:space-between; flex-wrap:wrap}
Â  Â  .brand{display:flex; align-items:center; gap:12px}
Â  Â  .logo{width:42px; height:42px; border-radius:14px; background:linear-gradient(135deg,var(--accent),var(--primary)); display:grid; place-items:center; color:#0b1020; font-weight:800; box-shadow:var(--shadow)}
Â  Â  h1{font-size: clamp(22px, 3vw, 32px); margin:0}
Â  Â  .progress{flex:1; min-width:240px; max-width:480px; height:12px; background: #0b1220; border-radius:999px; overflow:hidden; box-shadow:inset 0 0 0 1px #1b2640}
Â  Â  .bar{height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--primary)); transition:width .4s ease}
Â  Â  .card{background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid rgba(255,255,255,.08); border-radius: var(--radius); box-shadow: var(--shadow); padding:20px; display:flex; flex-direction:column; gap:16px}
Â  Â  .grid{display:grid; gap:16px}
Â  Â  @media(min-width:900px){ .grid{grid-template-columns: 1fr 1fr} }
Â  Â  .levels{display:grid; gap:12px}
Â  Â  .level{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:14px 16px; border-radius:14px; background: #0b1220; border:1px solid rgba(255,255,255,.06)}
Â  Â  .pill{padding:4px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.1)}
Â  Â  .pill.lock{background:#1a243d}
Â  Â  .pill.done{background:rgba(34,197,94,.2); color:#a7f3d0; border-color:rgba(34,197,94,.35)}
Â  Â  .btn{appearance:none; border:none; background:linear-gradient(135deg, var(--accent), var(--primary)); color:#06111e; font-weight:700; padding:12px 16px; border-radius:12px; cursor:pointer; transition: transform .08s ease, filter .2s ease; box-shadow: var(--shadow)}
Â  Â  .btn:active{transform:translateY(1px)}
Â  Â  .btn[disabled]{opacity:.5; filter:grayscale(1); cursor:not-allowed}
Â  Â  .game{margin-top:0}
Â  Â  .hidden{display:none !important}
Â  Â  .snake-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 16px; max-width: 200px; margin: 16px auto 0; }
Â  Â  .snake-controls button { grid-column: 2; }
Â  Â  .snake-controls button:nth-child(2) { grid-column: 1; }
Â  Â  .snake-controls button:nth-child(3) { grid-column: 3; }

Â  Â  /* Reflex */
Â  Â  .reflex{display:grid; place-items:center; height:280px; border-radius:14px; background:#091225; border:1px dashed rgba(255,255,255,.12); padding:18px; text-align:center}
Â  Â  .reflex.ready{background:#1e293b}
Â  Â  .reflex.go{background:#064e3b}
Â  Â  .reflex h2{margin:0}

Â  Â  /* Simon */
Â  Â  .simon{width:min(420px, 96%); margin:0 auto; display:grid; grid-template-columns:1fr 1fr; gap:10px}
Â  Â  .pad{height:120px; border-radius:14px; opacity:.85; border:2px solid rgba(255,255,255,.12); cursor:pointer; transition: transform .06s ease, opacity .2s, filter .06s}
Â  Â  .pad:active{transform:scale(.98)}
Â  Â  .pad.active{opacity:1; filter:brightness(2.6) saturate(1.5); box-shadow:0 0 0 10px rgba(255,255,255,.12) inset}
Â  Â  .p0{background:#b91c1c}
Â  Â  .p1{background:#b45309}
Â  Â  .p2{background:#15803d}
Â  Â  .p3{background:#1e40af}

Â  Â  /* Memory pairs - 16 coppie */
Â  Â  .pairs{display:grid; grid-template-columns: repeat(4, minmax(44px, 1fr)); gap:8px; max-width:960px; margin:0 auto}
Â  Â  .tile{aspect-ratio:1/1; border-radius:12px; display:grid; place-items:center; background:#0b1220; border:1px solid rgba(255,255,255,.1); font-size:16px; cursor:pointer; user-select:none; transition: transform .08s ease}
Â  Â  .tile.revealed{background:#13203a}
Â  Â  .tile.matched{background:#064e3b}

Â  Â  .quiz{display:grid; gap:10px; max-width:560px;color: var(--text)}
Â  Â  .opt{padding:12px; border-radius:12px; background:#0b1220; border:1px solid rgba(255,255,255,.08); cursor:pointer;color: var(--text); }
Â  Â  .opt.correct{outline:2px solid var(--primary)}
Â  Â  .opt.wrong{outline:2px solid var(--danger)}

Â  Â  .footer{margin-top:16px; color:var(--soft); font-size:12px}
Â  Â  .prize{display:grid; place-items:center; gap:14px; text-align:center; padding:20px; background: #081426; border-radius:16px; border:1px solid rgba(255,255,255,.08)}
Â  Â  .code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; letter-spacing: 2px; font-weight:800; background:#0b1220; padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.1)}
Â  Â  .toast{position:fixed; inset:auto 0 20px 0; display:grid; place-items:center; pointer-events:none}
Â  Â  .toast .msg{pointer-events:auto; background:#0b1220; border:1px solid rgba(255,255,255,.12); padding:10px 14px; border-radius:12px; box-shadow:var(--shadow)}

Â  Â  .diamond{width:12px; height:16px; transform:rotate(45deg); display:block}
Â  </style>
</head>
<body>
Â  <div class="wrap">
Â  Â  <header>
Â  Â  Â  <div class="brand">
Â  Â  Â  Â  <div class="logo">ğŸ¯</div>
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <h1>Gioco a Livelli â€“ Vinci il Premio!</h1>
Â  Â  Â  Â  Â  <div class="footer">Completa tutti i miniâ€‘giochi per sbloccare il premio finale.</div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  <div class="progress" aria-label="Progresso">
Â  Â  Â  Â  <div class="bar" id="progressBar"></div>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <main class="grid" style="margin-top:16px">
Â  Â  Â  <section class="card">
Â  Â  Â  Â  <h2 style="margin-top:0">Livelli</h2>
Â  Â  Â  Â  <div class="levels" id="levels"></div>
Â  Â  Â  Â  <div class="footer">Il progresso Ã¨ salvato nel browser (localStorage). Puoi chiudere e tornare piÃ¹ tardi.</div>
Â  Â  Â  </section>

Â  Â  Â  <section class="card">
Â  Â  Â  Â  <h2 style="margin-top:0" id="gameTitle">Scegli un livello</h2>
Â  Â  Â  Â  <div id="gameArea" class="game"></div>
Â  Â  Â  </section>
Â  Â  </main>

Â  Â  <section class="card hidden" id="prizeSection" style="margin-top:16px">
Â  Â  Â  <h2>ğŸ‰ Premio sbloccato!</h2>
Â  Â  Â  <div class="prize">
Â  Â  Â  Â  <p>Congratulazioni! Hai completato tutti i livelli. Ecco il tuo premio:</p>
Â  Â  Â  Â  <div class="code" id="prizeCode" aria-live="polite"></div>
Â  Â  Â  Â  <button class="btn" id="copyCodeBtn">Copia Codice</button>
Â  Â  Â  Â  <small class="footer">Suggerimento: Personalizza il testo del premio o collega un form per riscattarlo.</small>
Â  Â  Â  </div>
Â  Â  </section>
Â  </div>

Â  <div class="toast" id="toast" aria-live="polite" aria-atomic="true" role="status"></div>

Â  <script>
Â  Â  const state = {
Â  Â  Â  current: null,
Â  Â  Â  completed: JSON.parse(localStorage.getItem('completedLevels') || '[]'),
Â  Â  Â  prizeCode: localStorage.getItem('prizeCode') || null,
Â  Â  };

Â  Â  const LEVELS = [
Â  Â  Â  { id: 'snake', name: 'Livello 1 Â· Snake Diamanti', desc: 'Mangia i diamanti fino a lunghezza 30.', icon: 'ğŸ', run: gameSnake },
Â  Â  Â  { id: 'simon', name: 'Livello 2 Â· Simon 5', desc: 'Ripeti la sequenza di 5 lampeggi.', icon: 'ğŸ§ ', run: gameSimon },
Â  Â  Â  { id: 'reflex', name: 'Livello 3 Â· Reflex Rush', desc: 'Reagisci al segnale in meno di 400ms, 3 volte (max 10 tentativi).', icon: 'âš¡', run: gameReflex },
Â  Â  Â  { id: 'pairs', name: 'Livello 4 Â· Memory', desc: 'Abbina tutte le coppie di oggetti preziosi (8 coppie).', icon: 'ğŸ’', run: gamePairs },
Â  Â  Â  { id: 'quiz', Â name: 'Livello 5 Â· Quick Quiz', desc: 'Rispondi correttamente alle domande.', icon: 'â“', run: gameQuiz },
Â  Â  ];

Â  Â  function saveProgress(){ try { localStorage.setItem('completedLevels', JSON.stringify(state.completed)); } catch(e){} }
Â  Â  function showToast(text){
Â  Â  Â  const t = document.getElementById('toast');
Â  Â  Â  t.innerHTML = `<div class="msg">${text}</div>`;
Â  Â  Â  setTimeout(()=> t.innerHTML = '', 1600);
Â  Â  }
Â  Â  function updateProgressUI(){
Â  Â  Â  const bar = document.getElementById('progressBar');
Â  Â  Â  const pct = Math.round((state.completed.length / LEVELS.length) * 100);
Â  Â  Â  bar.style.width = pct + '%';
Â  Â  }

Â  Â  function renderLevels(){
Â  Â  Â  const container = document.getElementById('levels');
Â  Â  Â  container.innerHTML = '';
Â  Â  Â  LEVELS.forEach((lvl, idx) => {
Â  Â  Â  Â  const locked = idx > 0 && !state.completed.includes(LEVELS[idx-1].id);
Â  Â  Â  Â  const done = state.completed.includes(lvl.id);
Â  Â  Â  Â  const row = document.createElement('div');
Â  Â  Â  Â  row.className = 'level';
Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:12px">
Â  Â  Â  Â  Â  Â  <div style="font-size:22px">${lvl.icon}</div>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700">${lvl.name}</div>
Â  Â  Â  Â  Â  Â  Â  <small>${lvl.desc}</small>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div style="display:flex; align-items:center; gap:8px">
Â  Â  Â  Â  Â  Â  <span class="pill ${done ? 'done' : locked ? 'lock' : ''}">${done ? 'Completato' : locked ? 'Bloccato' : 'Pronto'}</span>
Â  Â  Â  Â  Â  Â  <button class="btn" ${locked ? 'disabled' : ''} aria-label="Gioca ${lvl.name}">Gioca</button>
Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  row.querySelector('button').onclick = () => startLevel(lvl);
Â  Â  Â  Â  container.appendChild(row);
Â  Â  Â  });
Â  Â  }

Â  Â  function startLevel(lvl){
Â  Â  Â  state.current = lvl.id;
Â  Â  Â  document.getElementById('gameTitle').textContent = lvl.name;
Â  Â  Â  const area = document.getElementById('gameArea');
Â  Â  Â  area.innerHTML = '';
Â  Â  Â  lvl.run(area, onCompleteLevel);
Â  Â  Â  window.scrollTo({ top: 0, behavior: 'smooth' });
Â  Â  }

Â  Â  function onCompleteLevel(id){
Â  Â  Â  if(!state.completed.includes(id)){
Â  Â  Â  Â  state.completed.push(id); saveProgress(); updateProgressUI(); renderLevels();
Â  Â  Â  Â  showToast('âœ… Livello completato!');
Â  Â  Â  }
Â  Â  Â  if(state.completed.length === LEVELS.length){ unlockPrize(); }
Â  Â  }

Â  Â  function unlockPrize(){
Â  Â  Â  const sec = document.getElementById('prizeSection');
Â  Â  Â  sec.classList.remove('hidden');
Â  Â  Â  diamondRain(220);
Â  Â  Â  const prizeContainer = document.getElementById('prizeCode');
Â  Â  Â  prizeContainer.textContent = 'ğŸ‰ Clicca qui per riscattare il tuo premio!';
Â  Â  Â  prizeContainer.style.color = 'var(--primary)';
Â  Â  Â  prizeContainer.style.cursor = 'pointer';
Â  Â  Â  prizeContainer.onclick = () => window.open('https://testairolanje-source.github.io/primo_rep/Pagine/gratta', '_blank');
Â  Â  }

Â  Â  const audioCtx = (typeof AudioContext !== 'undefined') ? new AudioContext() : null;
Â  Â  function playErrorTone(){ if(!audioCtx) return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type='sawtooth'; o.frequency.value=220; g.gain.value=0.0001; o.connect(g); g.connect(audioCtx.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime + 0.01); g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + 0.25); setTimeout(()=>{ o.stop(); }, 300); }

Â  Â  function diamondRain(n=80){
Â  Â  Â  for(let i=0;i<n;i++){
Â  Â  Â  Â  const s = document.createElement('div');
Â  Â  Â  Â  s.className = 'diamond';
Â  Â  Â  Â  s.textContent = 'ğŸ’';
Â  Â  Â  Â  s.style.position='fixed'; s.style.left=Math.random()*100+'vw'; s.style.top='-30px'; s.style.zIndex=9999;
Â  Â  Â  Â  document.body.appendChild(s);
Â  Â  Â  Â  const duration = 900 + Math.random()*1200;
Â  Â  Â  Â  const translateX = (Math.random()*2-1)*120;
Â  Â  Â  Â  s.animate([
Â  Â  Â  Â  Â  { transform: `translate(0px,0px) rotate(${Math.random()*360}deg)`, opacity:1 },
Â  Â  Â  Â  Â  { transform: `translate(${translateX}px, 110vh) rotate(${360+Math.random()*360}deg)`, opacity:0.9 }
Â  Â  Â  Â  ], { duration, easing:'cubic-bezier(.2,.8,.2,1)' }).addEventListener('finish', ()=> s.remove());
Â  Â  Â  }
Â  Â  }

Â  Â  // ========================= GIOCHI =======================================
Â  Â  function gameSnake(root,done){
Â  Â  Â  const canvas=document.createElement('canvas');
Â  Â  Â  canvas.width=400; canvas.height=400; canvas.className='snake';
Â  Â  Â  root.appendChild(canvas);
Â  Â  Â  const ctx=canvas.getContext('2d');
Â  Â  Â  let snake=[{x:10,y:10}],dir={x:1,y:0},food=randPos(),size=20,len=5;
Â  Â  Â  let loop=null;

Â  Â  Â  const controls = document.createElement('div');
Â  Â  Â  controls.className = 'snake-controls';
Â  Â  Â  controls.innerHTML = `
Â  Â  Â  Â  <div></div>
Â  Â  Â  Â  <button class="btn" data-dir="up">â¬†ï¸</button>
Â  Â  Â  Â  <div></div>
Â  Â  Â  Â  <button class="btn" data-dir="left">â¬…ï¸</button>
Â  Â  Â  Â  <button class="btn" data-dir="down">â¬‡ï¸</button>
Â  Â  Â  Â  <button class="btn" data-dir="right">â¡ï¸</button>
Â  Â  Â  `;
Â  Â  Â  root.appendChild(controls);

Â  Â  Â  // Listener per i pulsanti a schermo
Â  Â  Â  controls.addEventListener('click', (e) => {
Â  Â  Â  Â  const direction = e.target.dataset.dir;
Â  Â  Â  Â  if (!direction) return;

Â  Â  Â  Â  if (direction === 'up' && dir.y === 0) dir = { x: 0, y: -1 };
Â  Â  Â  Â  else if (direction === 'down' && dir.y === 0) dir = { x: 0, y: 1 };
Â  Â  Â  Â  else if (direction === 'left' && dir.x === 0) dir = { x: -1, y: 0 };
Â  Â  Â  Â  else if (direction === 'right' && dir.x === 0) dir = { x: 1, y: 0 };
Â  Â  Â  });
Â  Â  Â  
Â  Â  Â  // Listener per la tastiera (mantenuto per desktop)
Â  Â  Â  document.onkeydown=e=>{
Â  Â  Â  Â  if(e.key==='ArrowUp'&&dir.y===0)dir={x:0,y:-1};
Â  Â  Â  Â  if(e.key==='ArrowDown'&&dir.y===0)dir={x:0,y:1};
Â  Â  Â  Â  if(e.key==='ArrowLeft'&&dir.x===0)dir={x:-1,y:0};
Â  Â  Â  Â  if(e.key==='ArrowRight'&&dir.x===0)dir={x:1,y:0};
Â  Â  Â  };

Â  Â  Â  function randPos(){return {x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*20)}}
Â  Â  Â  function tick(){
Â  Â  Â  Â  const head={x:snake[0].x+dir.x,y:snake[0].y+dir.y};
Â  Â  Â  Â  if(head.x<0||head.y<0||head.x>=20||head.y>=20||snake.some(s=>s.x===head.x&&s.y===head.y)){
Â  Â  Â  Â  Â  clearInterval(loop); showToast('Game Over!'); resetGame(); return;
Â  Â  Â  Â  }
Â  Â  Â  Â  snake.unshift(head);
Â  Â  Â  Â  if(head.x===food.x&&head.y===food.y){ len++; food=randPos(); }
Â  Â  Â  Â  while(snake.length>len) snake.pop();
Â  Â  Â  Â  ctx.fillStyle='#000'; ctx.fillRect(0,0,400,400);
Â  Â  Â  Â  ctx.fillStyle='#22c55e'; snake.forEach(s=>ctx.fillRect(s.x*size,s.y*size,size-2,size-2));
Â  Â  Â  Â  ctx.fillStyle='#60a5fa'; ctx.fillText('ğŸ’',food.x*size+2,food.y*size+18);
Â  Â  Â  Â  if(len>=30){ clearInterval(loop); done('snake'); root.innerHTML='<h3>Snake completato!</h3>'; }
Â  Â  Â  }

Â  Â  Â  function resetGame(){
Â  Â  Â  Â  snake=[{x:10,y:10}];
Â  Â  Â  Â  dir={x:1,y:0};
Â  Â  Â  Â  food=randPos();
Â  Â  Â  Â  len=5;
Â  Â  Â  Â  loop=setInterval(tick,120);
Â  Â  Â  }
Â  Â  Â  resetGame();
Â  Â  }

Â  Â  function gameReflex(root, done){
Â  Â  Â  let successCount = 0; let attempts = 0; let waiting=false; let timeoutId=null; let started=false;
Â  Â  Â  const targetMs = 400;

Â  Â  Â  const box = document.createElement('div'); box.className='reflex ready';
Â  Â  Â  const txt = document.createElement('div'); txt.innerHTML = `<h2>Quando lo sfondo diventa verde, clicca subito!</h2><div class="footer">Obiettivo: 3 reazioni &lt; ${targetMs}ms â€” Hai ${10-attempts} tentativi rimasti</div>`;
Â  Â  Â  const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Avvia';
Â  Â  Â  const stats = document.createElement('div'); stats.className='footer';
Â  Â  Â  box.append(txt, btn, stats); root.appendChild(box);

Â  Â  Â  function updateFooter(){ txt.querySelector('.footer').textContent = `Obiettivo: 3 reazioni < ${targetMs}ms â€” Hai ${10-attempts} tentativi rimasti`; }

Â  Â  Â  function schedule(){ waiting=true; box.classList.remove('go'); box.classList.remove('reflex-fail'); box.classList.add('ready'); const delay = 900 + Math.random()*1800; timeoutId = setTimeout(()=>{ box.classList.remove('ready'); box.classList.add('go'); waiting=false; started = performance.now(); }, delay); }

Â  Â  Â  function resetGame(){ successCount=0; attempts=0; updateFooter(); stats.textContent=''; schedule(); btn.disabled=true; }

Â  Â  Â  btn.onclick = resetGame;

Â  Â  Â  box.onclick = ()=>{
Â  Â  Â  Â  if(btn.disabled !== true) return;
Â  Â  Â  Â  if(waiting){
Â  Â  Â  Â  Â  clearTimeout(timeoutId); attempts++; playErrorTone(); stats.textContent = 'Troppo presto!'; updateFooter(); box.classList.add('reflex-fail'); if(attempts>=10){ showToast('Hai esaurito i 10 tentativi â€” ricomincio il livello'); resetGame(); return; } schedule();
Â  Â  Â  Â  } else if(started){
Â  Â  Â  Â  Â  const t = Math.round(performance.now() - started);
Â  Â  Â  Â  Â  stats.textContent = `Reazione: ${t}ms`;
Â  Â  Â  Â  Â  if(t <= targetMs){ successCount++; showToast(`Ottimo! (${successCount}/3)`); diamondRain(80); }
Â  Â  Â  Â  Â  else { attempts++; playErrorTone(); showToast('Troppo lento ğŸ˜…'); updateFooter(); box.classList.add('reflex-fail'); }
Â  Â  Â  Â  Â  started=false;
Â  Â  Â  Â  Â  if(successCount>=3){ done('reflex'); diamondRain(140); root.replaceChildren(successUI('Livello completato!')); }
Â  Â  Â  Â  Â  else if(attempts>=10){ showToast('Hai esaurito i 10 tentativi â€” ricomincio il livello'); resetGame(); }
Â  Â  Â  Â  Â  else schedule();
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  }

Â  Â  function gameSimon(root, done){
Â  Â  Â  const n = 5; const seq = Array.from({length:n}, ()=> Math.floor(Math.random()*4));
Â  Â  Â  let playing=false; let input=[];
Â  Â  Â  const wrap = document.createElement('div');
Â  Â  Â  const info = document.createElement('div'); info.className='footer';
Â  Â  Â  const grid = document.createElement('div'); grid.className='simon';
Â  Â  Â  const pads = [0,1,2,3].map(i=>{ const d=document.createElement('div'); d.className='pad p'+i; d.setAttribute('role','button'); d.setAttribute('aria-label','Pad '+i); d.onclick=()=>press(i); grid.appendChild(d); return d; });
Â  Â  Â  const btn = document.createElement('button'); btn.className='btn'; btn.textContent='Mostra Sequenza';
Â  Â  Â  wrap.append(btn, info, grid); root.appendChild(wrap);
Â  Â  Â  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  const frequencies = [261.6, 329.6, 392.0, 523.3];
Â  Â  Â  function playTone(i, duration=0.3){
Â  Â  Â  Â  const osc = audioCtx.createOscillator();
Â  Â  Â  Â  const gain = audioCtx.createGain();
Â  Â  Â  Â  osc.frequency.value = frequencies[i]; osc.type = 'sine'; osc.connect(gain); gain.connect(audioCtx.destination);
Â  Â  Â  Â  gain.gain.setValueAtTime(0.2, audioCtx.currentTime); osc.start(); osc.stop(audioCtx.currentTime + duration);
Â  Â  Â  }
Â  Â  Â  function playErrorTone(){
Â  Â  Â  Â  const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.frequency.value = 120;
Â  Â  Â  Â  osc.type = 'sawtooth'; osc.connect(gain); gain.connect(audioCtx.destination); gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
Â  Â  Â  Â  osc.start(); osc.stop(audioCtx.currentTime + 0.5);
Â  Â  Â  }
Â  Â  Â  function flash(i){ pads[i].classList.add('active'); setTimeout(()=> pads[i].classList.remove('active'), 450); playTone(i); }
Â  Â  Â  function play(){ playing=true; input=[]; info.textContent='Osservaâ€¦'; btn.disabled=true; let t=0; seq.forEach((v,idx)=> setTimeout(()=>{ flash(v); if(idx===seq.length-1){ setTimeout(()=>{ playing=false; info.textContent='Tocca a te!'; }, 450); } }, t+=700)); }
Â  Â  Â  function press(i){ if(playing || btn.disabled!==true) return; flash(i); input.push(i); const correctSoFar = input.every((v,k)=> v===seq[k]); if(!correctSoFar){ playErrorTone(); showToast('Sequenza errata â€” riparti'); resetGame(); return; }
Â  Â  Â  Â  if(input.length===seq.length){ info.textContent='Ben fatto!'; diamondRain(120); wrap.replaceChildren(successUI('Sequenza corretta!')); done('simon'); }
Â  Â  Â  }
Â  Â  Â  function resetGame(){ root.innerHTML=''; gameSimon(root, done); }
Â  Â  Â  btn.onclick = play;
Â  Â  }

Â  Â  function gamePairs(root, done){
Â  Â  Â  const jewels = ['ğŸ’','ğŸ“¿','ğŸ“¯','ğŸ‘‘','ğŸ’','ğŸ“Œ','ğŸ“','ğŸ€'];
Â  Â  Â  const items = shuffle(jewels.concat(jewels));
Â  Â  Â  const grid = document.createElement('div'); grid.className='pairs';
Â  Â  Â  let first=null, lock=false, matched=0, wrongs=0;

Â  Â  Â  items.forEach((e,idx)=>{
Â  Â  Â  Â  const t = document.createElement('button'); t.className='tile'; t.textContent='?'; t.style.fontSize='13px'; t.setAttribute('aria-label','Carta coperta');
Â  Â  Â  Â  t.onclick = ()=>{
Â  Â  Â  Â  Â  if(lock || t.classList.contains('matched') || t===first) return;
Â  Â  Â  Â  Â  reveal(t,e);
Â  Â  Â  Â  Â  if(!first){ first=t; }
Â  Â  Â  Â  Â  else{
Â  Â  Â  Â  Â  Â  lock=true;
Â  Â  Â  Â  Â  Â  if(first.dataset.v === e){ first.classList.add('matched'); t.classList.add('matched'); matched+=2; showToast('Coppia trovata!'); first=null; lock=false; if(matched===items.length){ root.replaceChildren(successUI('Tutte le coppie abbinate!')); done('pairs'); } }
Â  Â  Â  Â  Â  Â  else{ wrongs++; playErrorTone(); setTimeout(()=>{ hide(first); hide(t); first=null; lock=false; showToast(`Sbagli: ${wrongs}/5`); if(wrongs>=6){ showToast('Hai sbagliato 5 volte â€” ricomincio il livello'); setTimeout(()=>{ resetGame(); }, 400); } }, 700); }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â  hide(t); grid.appendChild(t);
Â  Â  Â  });
Â  Â  Â  root.appendChild(grid);
Â  Â  Â  function reveal(el, v){ el.textContent = v; el.dataset.v = v; el.classList.add('revealed'); el.setAttribute('aria-label','Carta '+v); }
Â  Â  Â  function hide(el){ el.textContent='?'; el.classList.remove('revealed'); }
Â  Â  Â  function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } return arr; }
Â  Â  Â  function resetGame(){ root.innerHTML=''; gamePairs(root, done); }
Â  Â  }

Â  Â  function gameQuiz(root, done){
Â  Â  Â  const Q = [
Â  Â  Â  Â  { q:`Quale Ã¨ il metallo piÃ¹ prezioso?`, a:["Argento","Oro","Platino","Oro bianco","Titanio"], c:2 },
Â  Â  Â  Â  { q:`PerchÃ¨ il platino Ã¨ preferibile all'oro bianco?`, a:["Ãˆ piÃ¹ resistente e mantiene il colore nel tempo","Ha un colore piÃ¹ brillante","Costa meno","Ãˆ piÃ¹ leggero"], c:0 },
Â  Â  Â  Â  { q:`Che cosa misura il \"carato\"?`, a:["La purezza dell'oro","Il peso di una gemma (1 carato = 0.2 g)","La brillantezza di un diamante","La dimensione in millimetri"], c:1 },
Â  Â  Â  Â  { q:`Cosa Ã¨ un lab grown diamond?`, a:[
Â  Â  Â  Â  Â  Â  "Ãˆ un diamante sintetico di bassa qualitÃ ",
Â  Â  Â  Â  Â  Â  "Ãˆ una scelta economica ma meno bella",
Â  Â  Â  Â  Â  Â  "Ãˆ il diamante creato in laboratorio: perfetto, etico, senza impuritÃ  e senza lo sfruttamento di popolazioni per l'estrazione.",
Â  Â  Â  Â  Â  Â  "Non Ã¨ un diamante vero"
Â  Â  Â  Â  Â  ], c:2 }
Â  Â  Â  ];
Â  Â  Â  let idx=0, score=0; const wrap = document.createElement('div'); wrap.className='quiz'; const title = document.createElement('div'); title.style.fontWeight='900'; const opts = document.createElement('div'); opts.style.display='grid'; opts.style.gap='8px'; wrap.append(title, opts); root.appendChild(wrap);

Â  Â  Â  function render(){
Â  Â  Â  Â  if(idx>=Q.length){
Â  Â  Â  Â  Â  root.replaceChildren(successUI('Quiz completato!')); done('quiz');
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const cur = Q[idx];
Â  Â  Â  Â  title.textContent = `Domanda ${idx+1} di ${Q.length}: ${cur.q}`;
Â  Â  Â  Â  opts.innerHTML = '';
Â  Â  Â  Â  cur.a.forEach((txt,i)=>{
Â  Â  Â  Â  Â  const b = document.createElement('button'); b.className='opt'; b.textContent=txt;
Â  Â  Â  Â  Â  b.onclick = ()=>{
Â  Â  Â  Â  Â  Â  if(i===cur.c){ b.classList.add('correct'); score++; showToast('Giusto!'); idx++; setTimeout(()=> render(), 300); }
Â  Â  Â  Â  Â  Â  else { b.classList.add('wrong'); playErrorTone(); showToast('Sbagliato â€” ricomincio il quiz');
Â  Â  Â  Â  Â  Â  Â  setTimeout(()=>{ idx=0; score=0; wrap.replaceChildren(title, opts); render(); }, 700);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  opts.appendChild(b);
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â  render();
Â  Â  }

Â  Â  // utility
Â  Â  function successUI(text){ const box=document.createElement('div'); box.style.display='grid'; box.style.placeItems='center'; box.style.gap='10px'; box.style.height='200px'; const h=document.createElement('div'); h.style.fontSize='18px'; h.style.fontWeight='800'; h.textContent=text; const b=document.createElement('div'); b.className='footer'; b.textContent='Puoi tornare alla lista livelli.'; box.append('âœ…', h, b); return box; }

Â  Â  // copia codice
Â  Â  document.getElementById('copyCodeBtn').addEventListener('click', async () => {
Â  Â  Â  const code = document.getElementById('prizeCode').textContent;
Â  Â  Â  if(!code) return;
Â  Â  Â  try{ await navigator.clipboard.writeText(code); showToast('Codice copiato!'); }
Â  Â  Â  catch{ showToast('Impossibile copiare automaticamente.'); }
Â  Â  });

Â  Â  // init
Â  Â  renderLevels(); updateProgressUI(); if(state.completed.length === LEVELS.length) unlockPrize();
Â  </script>
</body>
</html>