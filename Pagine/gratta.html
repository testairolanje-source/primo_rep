<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gratta & Vinci - Sorpresa</title>
<style>
Â  :root{--accent:#ff6b6b;--muted:#9aa4b2}
Â  body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(180deg,#071426,#0f1724);color:#e6eef6}
Â  .wrap{max-width:1000px;margin:20px auto;padding:16px;text-align:center}
Â  .legend{background:rgba(255,255,255,.04);padding:10px;border-radius:10px;margin:12px 0}
Â  .legend ul{display:flex;flex-wrap:wrap;gap:8px;list-style:none;padding:0;margin:0;justify-content:center}
Â  .tickets{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
Â  .ticket{background:rgba(255,255,255,.03);padding:10px;border-radius:12px;position:relative}
Â  .ticket.locked{opacity:.6}
Â  .cells{display:flex;gap:6px}
Â  .cell{flex:1;position:relative;background:#fff;border-radius:8px;min-height:70px;display:flex;align-items:center;justify-content:center;font-size:28px}
Â  .symbol{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
Â  canvas.scratch{position:absolute;inset:0;width:100%;height:100%}
Â  .result{margin-top:6px;font-weight:600;min-height:20px}
Â  .next{margin-top:6px;padding:6px 10px;border-radius:8px;border:0;background:var(--accent);color:#fff}
Â  .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);z-index:50;opacity:0;pointer-events:none;transition:.2s}
Â  .modal.show{opacity:1;pointer-events:auto}
Â  .card{background:#071428;padding:16px;border-radius:12px}
Â  .diamond{position:fixed;top:-40px;font-size:22px;animation:fall 3s linear infinite;z-index:60}
Â  @keyframes fall{to{transform:translateY(120vh) rotate(360deg);opacity:0}}
Â  .flash{animation:flash .6s infinite}
Â  @keyframes flash{50%{filter:brightness(1.8)}}
Â  @media(max-width:520px){.cells{flex-direction:column}.cell{min-height:60px}}
</style>
</head>
<body>
<div class="wrap">
Â  Â  <p style="font-size: 1.1em; max-width: 600px; margin: 20px auto; text-align: center;">A tutti piacciono i giochi, ma certamente quelli che piacciono di piÃ¹ a te sono quelli d'azzardo, perciÃ² eccoti il tuo regalo, ben 8 gratta e vinci, chissÃ  che non vinci qualcosa.."</p>
Â  <h1>Buon Compleanno â€” Gratta & Vinci ğŸ‰</h1>
Â  <p class="lead">Gratta i biglietti in ordine e scopri le sorprese!</p>
Â  <div class="legend"><ul>
Â  Â  <li>ğŸ’ğŸ’ğŸ’ = 1â‚¬</li><li>ğŸ“ğŸ“ğŸ“ = 2â‚¬</li><li>ğŸŒğŸŒğŸŒ = 5â‚¬</li>
Â  Â  <li>ğŸğŸğŸ = 20â‚¬</li><li>ğŸ’¶ğŸ’¶ğŸ’¶ = 100â‚¬</li><li>ğŸ‘‘ğŸ‘‘ğŸ‘‘ = 500â‚¬</li><li>ğŸ’ğŸ’ğŸ’ = SuperPremio</li>
Â  </ul></div>
Â  <div class="tickets" id="tickets"></div>
</div>
<div class="modal" id="modal"><div class="card">
Â  <h3>Hai vinto il superpremio!</h3>
Â  <p>Preferisci aprirlo o prendere la busta da 500â‚¬?</p>
Â  <div style="display:flex;gap:10px;justify-content:center;margin-top:12px">
Â  Â  <button id="btn500">Busta 500â‚¬</button>
Â  Â  <button id="btnMyst">Superpremio</button>
Â  </div>
</div></div>
<script>
// short and robust implementation
const PR = {'ğŸ’':'1â‚¬','ğŸ“':'2â‚¬','ğŸŒ':'5â‚¬','ğŸ':'20â‚¬','ğŸ’¶':'100â‚¬','ğŸ‘‘':'500â‚¬','ğŸ’':'SuperPremio'};
const OUT = [['ğŸ’','ğŸ’','ğŸ’'],['ğŸ','ğŸ','ğŸ“'],['ğŸ’¶','ğŸ’¶','ğŸ“'],['ğŸ“','ğŸ“','ğŸ'],['ğŸŒ','ğŸŒ','ğŸŒ'],['ğŸ‘‘','ğŸ‘‘','ğŸ'],['ğŸ’','ğŸ’','ğŸ’'],['ğŸ’','ğŸ’','ğŸ’']];
const states = OUT.map(()=>({cells:[false,false,false],done:false,text:''}));
const ticketsEl = document.getElementById('tickets');
let audioCtx;
const play=(f,d=.12,t='sine',v=.06)=>{try{audioCtx=audioCtx||new(AudioContext||webkitAudioContext);let o=audioCtx.createOscillator(),g=audioCtx.createGain();o.type=t;o.frequency.value=f;g.gain.value=v;o.connect(g);g.connect(audioCtx.destination);o.start();setTimeout(()=>o.stop(),d*1000)}catch{}};
const winS=()=>[880,1100,1320].forEach((f,i)=>setTimeout(()=>play(f,.12,'sine',.06),i*140));
const loseS=()=>[320,260].forEach((f,i)=>setTimeout(()=>play(f,.12,'sawtooth',.05),i*150));
let superInt;const startSuper=()=>{const m=[440,660,880,660,440,330];let i=0;superInt=setInterval(()=>play(m[i++%m.length],.3,'sine',.06),300)};const stopSuper=()=>clearInterval(superInt);

function make(i){
Â  const t=document.createElement('div'); t.className='ticket'; if(i>0) t.classList.add('locked');
Â  t.innerHTML=`<h4>Biglietto ${i+1}</h4><div class="cells">${OUT[i].map(s=>`<div class="cell"><div class="symbol">${s}</div><canvas class="scratch"></canvas></div>`).join('')}</div><div class="result"></div><button class="next" disabled>Prossimo</button>`;
Â  ticketsEl.appendChild(t);
Â  const canvases = t.querySelectorAll('canvas');
Â  canvases.forEach((cv,ci)=>initCanvas(cv,i,ci,t));
Â  const res = t.querySelector('.result');
Â  const btn = t.querySelector('.next');
Â  btn.addEventListener('click',()=>{states[i].done=true; t.classList.add('completed','locked'); btn.disabled=true; const n=t.nextElementSibling; if(n) n.classList.remove('locked'); if(n) setTimeout(()=>n.scrollIntoView({behavior:'smooth',block:'center'}),120)});
Â  t.check = ()=>{
Â  Â  if(states[i].done) return;
Â  Â  if(states[i].cells.every(v=>v)){
Â  Â  Â  const win = OUT[i][0]===OUT[i][1] && OUT[i][1]===OUT[i][2];
Â  Â  Â  res.textContent = win? `Hai vinto ${PR[OUT[i][0]]}` : 'Hai Perso';
Â  Â  Â  states[i].done = true; states[i].text = res.textContent; btn.disabled=false; win?winS():loseS();
Â  Â  Â  if(i===OUT.length-1 && win && OUT[i][0]==='ğŸ’') celebrate();
Â  Â  }
Â  };
Â  // if already completed (reload), show text
Â  if(states[i].done) res.textContent = states[i].text;
}

function initCanvas(cv,i,ci,ticket){
Â  const parentCell = cv.parentElement;
Â  const ctxCanvas = ()=>cv.getContext('2d');
Â  function setup(){
Â  Â  const r = parentCell.getBoundingClientRect();
Â  Â  cv.width = Math.max(1, Math.floor(r.width * devicePixelRatio));
Â  Â  cv.height = Math.max(1, Math.floor(r.height * devicePixelRatio));
Â  Â  cv.style.width = r.width + 'px'; cv.style.height = r.height + 'px';
Â  Â  const c = ctxCanvas(); c.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
Â  Â  c.fillStyle = '#bdbdbd'; c.fillRect(0,0,r.width,r.height); c.globalCompositeOperation='destination-out';
Â  Â  cv.style.background = 'none';
Â  Â  if(states[i].cells[ci]){ c.clearRect(0,0,r.width,r.height); cv.style.pointerEvents='none'; }
Â  }
Â  setup();
Â  let drawing=false;
Â  function getRect(){ return parentCell.getBoundingClientRect(); }
Â  function pointerDown(e){ if(ticket.classList.contains('locked')||states[i].done) return; if(e.cancelable) e.preventDefault(); audioCtx?.resume?.(); drawing=true; draw(e); }
Â  function pointerUp(e){ if(e && e.cancelable) e.preventDefault(); drawing=false; check(); }
Â  function draw(e){ if(!drawing) return; const r=getRect(); const c = ctxCanvas(); const clientX = e.touches?e.touches[0].clientX:e.clientX; const clientY = e.touches?e.touches[0].clientY:e.clientY; const x = clientX - r.left; const y = clientY - r.top; const radius = Math.max(12, Math.min(26, r.width*0.06)); c.beginPath(); c.arc(x,y,radius,0,Math.PI*2); c.fill(); play(600,0.03,'square',0.02); if(e.cancelable) e.preventDefault(); }
Â  function check(){ const r = parentCell.getBoundingClientRect(); const tw=8, th=8; const tmp = document.createElement('canvas'); tmp.width=tw; tmp.height=th; const tctx = tmp.getContext('2d'); tctx.drawImage(cv,0,0,tw,th); const data = tctx.getImageData(0,0,tw,th).data; let cleared=0; for(let p=3;p<data.length;p+=4) if(data[p]===0) cleared++; if(cleared/(tw*th) > 0.8){ const c = ctxCanvas(); c.clearRect(0,0,r.width,r.height); cv.style.pointerEvents='none'; states[i].cells[ci]=true; ticket.check(); } }
Â  cv.addEventListener('pointerdown', pointerDown, {passive:false});
Â  window.addEventListener('pointerup', pointerUp);
Â  cv.addEventListener('pointermove', draw);
Â  cv.addEventListener('touchstart', pointerDown, {passive:false});
Â  cv.addEventListener('touchmove', draw, {passive:false});
Â  // reposition/resize handlers
Â  let deb; window.addEventListener('resize', ()=>{ clearTimeout(deb); deb=setTimeout(setup,80); }, {passive:true}); window.addEventListener('scroll', ()=>{ clearTimeout(deb); deb=setTimeout(setup,80); }, {passive:true});
}

function celebrate(){ document.body.classList.add('flash'); startSuper(); for(let i=0;i<25;i++){ const d=document.createElement('div'); d.className='diamond'; d.textContent='ğŸ’'; d.style.left=(5+Math.random()*90)+'%'; d.style.fontSize=(16+Math.random()*24)+'px'; d.style.animationDuration=(2+Math.random()*2)+'s'; document.body.appendChild(d); setTimeout(()=>d.remove(),5500); } setTimeout(()=>document.getElementById('modal').classList.add('show'),800); }

['btn500','btnMyst'].forEach(id=>document.getElementById(id).addEventListener('click',()=>{ stopSuper(); location.href='https://testairolanje-source.github.io/primo_rep/Pagine/quiz' }));

OUT.forEach((_,i)=>make(i));
</script>
</body>
</html>